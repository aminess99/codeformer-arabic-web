# CodeFormer - واجهة الويب

## نظرة عامة
هذا هو تطبيق ويب لـ CodeFormer يتيح للمستخدمين رفع الصور ومعالجتها باستخدام تقنيات الذكاء الاصطناعي لاستعادة وتحسين الوجوه.

## الميزات
- 🎭 **استعادة الوجوه**: تحسين جودة الوجوه في الصور القديمة أو المشوهة
- 🎨 **التلوين التلقائي**: إضافة الألوان للصور بالأبيض والأسود
- 🖼️ **ملء الفراغات**: إصلاح الأجزاء المفقودة في الصور
- ⚡ **معالجة سريعة**: نتائج عالية الجودة في وقت قياسي
- 📱 **تصميم متجاوب**: يعمل على جميع الأجهزة
- 🌐 **واجهة عربية**: دعم كامل للغة العربية

## متطلبات النظام
- Python 3.8 أو أحدث
- CUDA (اختياري للمعالجة السريعة)
- ذاكرة وصول عشوائي: 8GB على الأقل
- مساحة تخزين: 5GB على الأقل

## التثبيت والإعداد

### 1. تثبيت المتطلبات الأساسية
```bash
# تثبيت متطلبات CodeFormer الأساسية
pip install -r requirements.txt
python basicsr/setup.py develop

# تثبيت متطلبات الخادم الإضافية
pip install -r web_requirements.txt
```

### 2. تحميل النماذج المدربة مسبقاً
```bash
# تحميل نماذج facelib
python scripts/download_pretrained_models.py facelib

# تحميل نماذج CodeFormer
python scripts/download_pretrained_models.py CodeFormer

# تحميل نماذج dlib (اختياري)
python scripts/download_pretrained_models.py dlib
```

### 3. تشغيل الخادم
```bash
python web_server.py
```

### 4. فتح المتصفح
افتح المتصفح وانتقل إلى:
```
http://localhost:5000
```

## كيفية الاستخدام

### 1. رفع الصورة
- اضغط على منطقة الرفع أو اسحب الصورة إليها
- الصيغ المدعومة: JPG, PNG, WEBP
- الحد الأقصى لحجم الملف: 10MB

### 2. ضبط الإعدادات
- **مستوى الدقة (w)**: يتراوح من 0 إلى 1
  - قيم أقل (0.1-0.3): جودة أعلى، دقة أقل
  - قيم أعلى (0.7-1.0): دقة أعلى، جودة أقل
  - القيمة المُوصى بها: 0.5

- **نوع المعالجة**:
  - استعادة الوجه: للصور العادية
  - التلوين: للصور بالأبيض والأسود
  - ملء الفراغات: للصور التالفة

### 3. معالجة الصورة
- اضغط على زر "معالجة الصورة"
- انتظر حتى اكتمال المعالجة
- ستظهر النتيجة مع مقارنة بين الصورة الأصلية والمحسنة

### 4. تحميل النتيجة
- اضغط على زر "تحميل النتيجة" لحفظ الصورة المحسنة

## هيكل الملفات
```
CodeFormer/
├── web_interface.html      # واجهة المستخدم
├── web_server.py           # الخادم الخلفي
├── web_requirements.txt    # متطلبات الخادم
├── WEB_README.md          # هذا الملف
└── weights/               # النماذج المدربة
    ├── CodeFormer/
    └── facelib/
```

## API المتاح

### POST /api/process
معالجة الصورة

**المعاملات:**
```json
{
  "image": "data:image/jpeg;base64,...",
  "w": 0.5,
  "mode": "restoration"
}
```

**الاستجابة:**
```json
{
  "success": true,
  "result_image": "data:image/png;base64,..."
}
```

### GET /api/status
حالة الخادم

**الاستجابة:**
```json
{
  "status": "running",
  "device": "cuda",
  "model_loaded": true
}
```

## استكشاف الأخطاء

### مشاكل شائعة وحلولها

1. **خطأ في تحميل النموذج**
   ```
   تأكد من تحميل النماذج المدربة مسبقاً:
   python scripts/download_pretrained_models.py CodeFormer
   ```

2. **نفاد الذاكرة**
   ```
   قلل من حجم الصورة أو استخدم CPU بدلاً من GPU
   ```

3. **بطء في المعالجة**
   ```
   تأكد من تثبيت CUDA للمعالجة السريعة
   ```

4. **خطأ في الاتصال**
   ```
   تأكد من تشغيل الخادم على المنفذ 5000
   تحقق من إعدادات الجدار الناري
   ```

## التخصيص

### تغيير المنفذ
عدّل السطر الأخير في `web_server.py`:
```python
app.run(host='0.0.0.0', port=8080, debug=True)
```

### إضافة ميزات جديدة
- عدّل `web_server.py` لإضافة endpoints جديدة
- عدّل `web_interface.html` لإضافة عناصر واجهة جديدة

## الأمان

⚠️ **تحذيرات مهمة:**
- هذا الخادم مُصمم للاستخدام المحلي فقط
- لا تستخدمه في بيئة الإنتاج بدون إعدادات أمان إضافية
- تأكد من تشفير الاتصالات في البيئات العامة

## الدعم

للحصول على المساعدة:
1. تحقق من [المستودع الأصلي](https://github.com/sczhou/CodeFormer)
2. راجع [الوثائق الرسمية](https://shangchenzhou.com/projects/CodeFormer/)
3. ابحث في [المشاكل المعروفة](https://github.com/sczhou/CodeFormer/issues)

## الترخيص
هذا المشروع مرخص تحت [NTU S-Lab License 1.0](LICENSE)

---

**ملاحظة:** هذه واجهة ويب غير رسمية لـ CodeFormer. للاستخدام التجاري، يرجى مراجعة شروط الترخيص الأصلية.